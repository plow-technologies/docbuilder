<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Development.Shake.Util</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Development-Shake-Util.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Development-Shake-Util.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">shake-0.15.10: Build system library, like Make, but more accurate dependencies.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Development.Shake.Util</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A module for useful utility functions for Shake build systems.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:parseMakefile">parseMakefile</a> :: <a href="../base-4.8.2.0/Data-String.html#t:String">String</a> -&gt; [(<a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a>, [<a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a>])]</li><li class="src short"><a href="#v:needMakefileDependencies">needMakefileDependencies</a> :: <a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="Development-Shake.html#t:Action">Action</a> ()</li><li class="src short"><a href="#v:neededMakefileDependencies">neededMakefileDependencies</a> :: <a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="Development-Shake.html#t:Action">Action</a> ()</li><li class="src short"><a href="#v:shakeArgsAccumulate">shakeArgsAccumulate</a> :: <a href="Development-Shake.html#t:ShakeOptions">ShakeOptions</a> -&gt; [<a href="../base-4.8.2.0/System-Console-GetOpt.html#t:OptDescr">OptDescr</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="../base-4.8.2.0/Data-String.html#t:String">String</a> (a -&gt; a))] -&gt; a -&gt; (a -&gt; [<a href="../base-4.8.2.0/Data-String.html#t:String">String</a>] -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Development-Shake.html#t:Rules">Rules</a> ()))) -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:shakeArgsPrune">shakeArgsPrune</a> :: <a href="Development-Shake.html#t:ShakeOptions">ShakeOptions</a> -&gt; ([<a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a>] -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()) -&gt; <a href="Development-Shake.html#t:Rules">Rules</a> () -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:shakeArgsPruneWith">shakeArgsPruneWith</a> :: <a href="Development-Shake.html#t:ShakeOptions">ShakeOptions</a> -&gt; ([<a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a>] -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()) -&gt; [<a href="../base-4.8.2.0/System-Console-GetOpt.html#t:OptDescr">OptDescr</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="../base-4.8.2.0/Data-String.html#t:String">String</a> a)] -&gt; ([a] -&gt; [<a href="../base-4.8.2.0/Data-String.html#t:String">String</a>] -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Development-Shake.html#t:Rules">Rules</a> ()))) -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a name="v:parseMakefile" class="def">parseMakefile</a> :: <a href="../base-4.8.2.0/Data-String.html#t:String">String</a> -&gt; [(<a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a>, [<a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a>])] <a href="src/Development-Shake-Util.html#parseMakefile" class="link">Source</a></p><div class="doc"><p>Given the text of a Makefile, extract the list of targets and dependencies. Assumes a
   small subset of Makefile syntax, mostly that generated by <code>gcc -MM</code>.</p><pre>parseMakefile &quot;a: b c\nd : e&quot; == [(&quot;a&quot;,[&quot;b&quot;,&quot;c&quot;]),(&quot;d&quot;,[&quot;e&quot;])]</pre></div></div><div class="top"><p class="src"><a name="v:needMakefileDependencies" class="def">needMakefileDependencies</a> :: <a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="Development-Shake.html#t:Action">Action</a> () <a href="src/Development-Shake-Util.html#needMakefileDependencies" class="link">Source</a></p><div class="doc"><p>Depend on the dependencies listed in a Makefile. Does not depend on the Makefile itself.</p><pre>needMakefileDependencies file = need . concatMap snd . parseMakefile =&lt;&lt; liftIO (readFile file)</pre></div></div><div class="top"><p class="src"><a name="v:neededMakefileDependencies" class="def">neededMakefileDependencies</a> :: <a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="Development-Shake.html#t:Action">Action</a> () <a href="src/Development-Shake-Util.html#neededMakefileDependencies" class="link">Source</a></p><div class="doc"><p>Depend on the dependencies listed in a Makefile. Does not depend on the Makefile itself.
   Use this function to indicate that you have <em>already</em> used the files in question.</p><pre>neededMakefileDependencies file = needed . concatMap snd . parseMakefile =&lt;&lt; liftIO (readFile file)</pre></div></div><div class="top"><p class="src"><a name="v:shakeArgsAccumulate" class="def">shakeArgsAccumulate</a> :: <a href="Development-Shake.html#t:ShakeOptions">ShakeOptions</a> -&gt; [<a href="../base-4.8.2.0/System-Console-GetOpt.html#t:OptDescr">OptDescr</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="../base-4.8.2.0/Data-String.html#t:String">String</a> (a -&gt; a))] -&gt; a -&gt; (a -&gt; [<a href="../base-4.8.2.0/Data-String.html#t:String">String</a>] -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Development-Shake.html#t:Rules">Rules</a> ()))) -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/Development-Shake-Util.html#shakeArgsAccumulate" class="link">Source</a></p><div class="doc"><p>Like <code><a href="Development-Shake.html#v:shakeArgsWith">shakeArgsWith</a></code>, but instead of accumulating a list of flags, apply functions to a default value.
   Usually used to populate a record structure. As an example of a build system that can use either <code>gcc</code> or <code>distcc</code> for compiling:</p><pre>import System.Console.GetOpt

data Flags = Flags {distCC :: Bool} deriving Eq
flags = [Option &quot;&quot; [&quot;distcc&quot;] (NoArg $ Right $ \x -&gt; x{distCC=True}) &quot;Run distributed.&quot;]

main = <code><a href="Development-Shake-Util.html#v:shakeArgsAccumulate">shakeArgsAccumulate</a></code> <code><a href="Development-Shake.html#v:shakeOptions">shakeOptions</a></code> flags (Flags False) $ \flags targets -&gt; return $ Just $ do
    if null targets then <code><a href="Development-Shake.html#v:want">want</a></code> [&quot;result.exe&quot;] else <code><a href="Development-Shake.html#v:want">want</a></code> targets
    let compiler = if distCC flags then &quot;distcc&quot; else &quot;gcc&quot;
    &quot;*.o&quot; <code><a href="Development-Shake.html#v:-37--62-">%&gt;</a></code> \out -&gt; do
        <code><a href="Development-Shake.html#v:need">need</a></code> ...
        <code><a href="Development-Shake-Command.html#v:cmd">cmd</a></code> compiler ...
    ...
</pre><p>Now you can pass <code>--distcc</code> to use the <code>distcc</code> compiler.</p></div></div><div class="top"><p class="src"><a name="v:shakeArgsPrune" class="def">shakeArgsPrune</a> :: <a href="Development-Shake.html#t:ShakeOptions">ShakeOptions</a> -&gt; ([<a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a>] -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()) -&gt; <a href="Development-Shake.html#t:Rules">Rules</a> () -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/Development-Shake-Util.html#shakeArgsPrune" class="link">Source</a></p><div class="doc"><p>Like <code><a href="Development-Shake.html#v:shakeArgs">shakeArgs</a></code> but also takes a pruning function. If <code>--prune</code> is passed, then after the build has completed,
   the second argument is called with a list of the files that the build checked were up-to-date.</p></div></div><div class="top"><p class="src"><a name="v:shakeArgsPruneWith" class="def">shakeArgsPruneWith</a> :: <a href="Development-Shake.html#t:ShakeOptions">ShakeOptions</a> -&gt; ([<a href="../base-4.8.2.0/System-IO.html#t:FilePath">FilePath</a>] -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()) -&gt; [<a href="../base-4.8.2.0/System-Console-GetOpt.html#t:OptDescr">OptDescr</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="../base-4.8.2.0/Data-String.html#t:String">String</a> a)] -&gt; ([a] -&gt; [<a href="../base-4.8.2.0/Data-String.html#t:String">String</a>] -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Development-Shake.html#t:Rules">Rules</a> ()))) -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/Development-Shake-Util.html#shakeArgsPruneWith" class="link">Source</a></p><div class="doc"><p>A version of <code><a href="Development-Shake-Util.html#v:shakeArgsPrune">shakeArgsPrune</a></code> that also takes a list of extra options to use.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>