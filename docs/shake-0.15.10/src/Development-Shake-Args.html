<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Development/Shake/Args.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a>
<a name="line-2"></a><span class='hs-comment'>-- | Command line parsing flags.</span>
<a name="line-3"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Development</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span><span class='hs-varop'>.</span><span class='hs-conid'>Args</span><span class='hs-layout'>(</span><span class='hs-varid'>shakeOptDescrs</span><span class='hs-layout'>,</span> <span class='hs-varid'>shakeArgs</span><span class='hs-layout'>,</span> <span class='hs-varid'>shakeArgsWith</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Paths_shake</span>
<a name="line-6"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Development</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-7"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Development</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span>
<a name="line-8"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Development</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span><span class='hs-varop'>.</span><span class='hs-conid'>Demo</span>
<a name="line-9"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Development</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span><span class='hs-varop'>.</span><span class='hs-conid'>FilePath</span>
<a name="line-10"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Development</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span><span class='hs-varop'>.</span><span class='hs-conid'>Rules</span><span class='hs-varop'>.</span><span class='hs-conid'>File</span>
<a name="line-11"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Development</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span><span class='hs-varop'>.</span><span class='hs-conid'>Progress</span>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Development</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span><span class='hs-varop'>.</span><span class='hs-conid'>Shake</span>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>General</span><span class='hs-varop'>.</span><span class='hs-conid'>Timing</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Tuple</span><span class='hs-varop'>.</span><span class='hs-conid'>Extra</span>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Concurrent</span>
<a name="line-17"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span><span class='hs-varop'>.</span><span class='hs-conid'>Extra</span>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Either</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Time</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Version</span><span class='hs-layout'>(</span><span class='hs-varid'>showVersion</span><span class='hs-layout'>)</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Console</span><span class='hs-varop'>.</span><span class='hs-conid'>GetOpt</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Directory</span>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Environment</span>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Exit</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Time</span><span class='hs-varop'>.</span><span class='hs-conid'>Extra</span>
<a name="line-30"></a>
<a name="line-31"></a>
<a name="line-32"></a><a name="shakeArgs"></a><span class='hs-comment'>-- | Run a build system using command line arguments for configuration.</span>
<a name="line-33"></a><span class='hs-comment'>--   The available flags are those from 'shakeOptDescrs', along with a few additional</span>
<a name="line-34"></a><span class='hs-comment'>--   @make@ compatible flags that are not represented in 'ShakeOptions', such as @--print-directory@.</span>
<a name="line-35"></a><span class='hs-comment'>--   If there are no file arguments then the 'Rules' are used directly, otherwise the file arguments</span>
<a name="line-36"></a><span class='hs-comment'>--   are 'want'ed (after calling 'withoutActions'). As an example:</span>
<a name="line-37"></a><span class='hs-comment'>--</span>
<a name="line-38"></a><span class='hs-comment'>-- @</span>
<a name="line-39"></a><span class='hs-comment'>-- main = 'shakeArgs' 'shakeOptions'{'shakeFiles' = \"_make\", 'shakeProgress' = 'progressSimple'} $ do</span>
<a name="line-40"></a><span class='hs-comment'>--     'phony' \"clean\" $ 'Development.Shake.removeFilesAfter' \"_make\" [\"\/\/*\"]</span>
<a name="line-41"></a><span class='hs-comment'>--     'want' [\"_make\/neil.txt\",\"_make\/emily.txt\"]</span>
<a name="line-42"></a><span class='hs-comment'>--     \"_make\/*.txt\" '%&gt;' \\out -&gt;</span>
<a name="line-43"></a><span class='hs-comment'>--         ... build action here ...</span>
<a name="line-44"></a><span class='hs-comment'>-- @</span>
<a name="line-45"></a><span class='hs-comment'>--</span>
<a name="line-46"></a><span class='hs-comment'>--   This build system will default to building @neil.txt@ and @emily.txt@, while showing progress messages,</span>
<a name="line-47"></a><span class='hs-comment'>--   and putting the Shake files in locations such as @_make\/.database@. Some example command line flags:</span>
<a name="line-48"></a><span class='hs-comment'>--</span>
<a name="line-49"></a><span class='hs-comment'>-- * @main --no-progress@ will turn off progress messages.</span>
<a name="line-50"></a><span class='hs-comment'>--</span>
<a name="line-51"></a><span class='hs-comment'>-- * @main -j6@ will build on 6 threads.</span>
<a name="line-52"></a><span class='hs-comment'>--</span>
<a name="line-53"></a><span class='hs-comment'>-- * @main --help@ will display a list of supported flags.</span>
<a name="line-54"></a><span class='hs-comment'>--</span>
<a name="line-55"></a><span class='hs-comment'>-- * @main clean@ will not build anything, but will remove the @_make@ directory, including the</span>
<a name="line-56"></a><span class='hs-comment'>--   any 'shakeFiles'.</span>
<a name="line-57"></a><span class='hs-comment'>--</span>
<a name="line-58"></a><span class='hs-comment'>-- * @main _make/henry.txt@ will not build @neil.txt@ or @emily.txt@, but will instead build @henry.txt@.</span>
<a name="line-59"></a><span class='hs-definition'>shakeArgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShakeOptions</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rules</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-60"></a><span class='hs-definition'>shakeArgs</span> <span class='hs-varid'>opts</span> <span class='hs-varid'>rules</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>shakeArgsWith</span> <span class='hs-varid'>opts</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>f</span>
<a name="line-61"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>files</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>files</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>rules</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>want</span> <span class='hs-varid'>files</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>withoutActions</span> <span class='hs-varid'>rules</span>
<a name="line-62"></a>
<a name="line-63"></a>
<a name="line-64"></a><a name="shakeArgsWith"></a><span class='hs-comment'>-- | A version of 'shakeArgs' with more flexible handling of command line arguments.</span>
<a name="line-65"></a><span class='hs-comment'>--   The caller of 'shakeArgsWith' can add additional flags (the second argument) and chose how to convert</span>
<a name="line-66"></a><span class='hs-comment'>--   the flags/arguments into rules (the third argument). Given:</span>
<a name="line-67"></a><span class='hs-comment'>--</span>
<a name="line-68"></a><span class='hs-comment'>-- @</span>
<a name="line-69"></a><span class='hs-comment'>-- 'shakeArgsWith' opts flags (\\flagValues argValues -&gt; result)</span>
<a name="line-70"></a><span class='hs-comment'>-- @</span>
<a name="line-71"></a><span class='hs-comment'>--</span>
<a name="line-72"></a><span class='hs-comment'>-- * @opts@ is the initial 'ShakeOptions' value, which may have some fields overriden by command line flags.</span>
<a name="line-73"></a><span class='hs-comment'>--   This argument is usually 'shakeOptions', perhaps with a few fields overriden.</span>
<a name="line-74"></a><span class='hs-comment'>--</span>
<a name="line-75"></a><span class='hs-comment'>-- * @flags@ is a list of flag descriptions, which either produce a 'String' containing an error</span>
<a name="line-76"></a><span class='hs-comment'>--   message (typically for flags with invalid arguments, .e.g. @'Left' \"could not parse as int\"@), or a value</span>
<a name="line-77"></a><span class='hs-comment'>--   that is passed as @flagValues@. If you have no custom flags, pass @[]@.</span>
<a name="line-78"></a><span class='hs-comment'>--</span>
<a name="line-79"></a><span class='hs-comment'>-- * @flagValues@ is a list of custom flags that the user supplied. If @flags == []@ then this list will</span>
<a name="line-80"></a><span class='hs-comment'>--   be @[]@.</span>
<a name="line-81"></a><span class='hs-comment'>--</span>
<a name="line-82"></a><span class='hs-comment'>-- * @argValues@ is a list of non-flag arguments, which are often treated as files and passed to 'want'.</span>
<a name="line-83"></a><span class='hs-comment'>--</span>
<a name="line-84"></a><span class='hs-comment'>-- * @result@ should produce a 'Nothing' to indicate that no building needs to take place, or a 'Just'</span>
<a name="line-85"></a><span class='hs-comment'>--   providing the rules that should be used.</span>
<a name="line-86"></a><span class='hs-comment'>--</span>
<a name="line-87"></a><span class='hs-comment'>--   As an example of a build system that can use either @gcc@ or @distcc@ for compiling:</span>
<a name="line-88"></a><span class='hs-comment'>--</span>
<a name="line-89"></a><span class='hs-comment'>-- @</span>
<a name="line-90"></a><span class='hs-comment'>-- import System.Console.GetOpt</span>
<a name="line-91"></a><span class='hs-comment'>--</span>
<a name="line-92"></a><span class='hs-comment'>-- data Flags = DistCC deriving Eq</span>
<a name="line-93"></a><span class='hs-comment'>-- flags = [Option \"\" [\"distcc\"] (NoArg $ Right DistCC) \"Run distributed.\"]</span>
<a name="line-94"></a><span class='hs-comment'>--</span>
<a name="line-95"></a><span class='hs-comment'>-- main = 'shakeArgsWith' 'shakeOptions' flags $ \\flags targets -&gt; return $ Just $ do</span>
<a name="line-96"></a><span class='hs-comment'>--     if null targets then 'want' [\"result.exe\"] else 'want' targets</span>
<a name="line-97"></a><span class='hs-comment'>--     let compiler = if DistCC \`elem\` flags then \"distcc\" else \"gcc\"</span>
<a name="line-98"></a><span class='hs-comment'>--     \"*.o\" '%&gt;' \\out -&gt; do</span>
<a name="line-99"></a><span class='hs-comment'>--         'need' ...</span>
<a name="line-100"></a><span class='hs-comment'>--         'cmd' compiler ...</span>
<a name="line-101"></a><span class='hs-comment'>--     ...</span>
<a name="line-102"></a><span class='hs-comment'>-- @</span>
<a name="line-103"></a><span class='hs-comment'>--</span>
<a name="line-104"></a><span class='hs-comment'>--   Now you can pass @--distcc@ to use the @distcc@ compiler.</span>
<a name="line-105"></a><span class='hs-definition'>shakeArgsWith</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ShakeOptions</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>OptDescr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Rules</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-106"></a><span class='hs-definition'>shakeArgsWith</span> <span class='hs-varid'>baseOpts</span> <span class='hs-varid'>userOptions</span> <span class='hs-varid'>rules</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-107"></a>    <span class='hs-varid'>addTiming</span> <span class='hs-str'>"shakeArgsWith"</span>
<a name="line-108"></a>    <span class='hs-varid'>args</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-109"></a>    <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>flags</span><span class='hs-layout'>,</span><span class='hs-varid'>files</span><span class='hs-layout'>,</span><span class='hs-varid'>errs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getOpt</span> <span class='hs-conid'>Permute</span> <span class='hs-varid'>opts</span> <span class='hs-varid'>args</span>
<a name="line-110"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>flagsError</span><span class='hs-layout'>,</span><span class='hs-varid'>flag1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>partitionEithers</span> <span class='hs-varid'>flags</span>
<a name="line-111"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>self</span><span class='hs-layout'>,</span><span class='hs-varid'>user</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>partitionEithers</span> <span class='hs-varid'>flag1</span>
<a name="line-112"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>flagsExtra</span><span class='hs-layout'>,</span><span class='hs-varid'>flagsShake</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>first</span> <span class='hs-varid'>concat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unzip</span> <span class='hs-varid'>self</span>
<a name="line-113"></a>        <span class='hs-varid'>assumeNew</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AssumeNew</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>flagsExtra</span><span class='hs-keyglyph'>]</span>
<a name="line-114"></a>        <span class='hs-varid'>assumeOld</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AssumeOld</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>flagsExtra</span><span class='hs-keyglyph'>]</span>
<a name="line-115"></a>        <span class='hs-varid'>progressReplays</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ProgressReplay</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>flagsExtra</span><span class='hs-keyglyph'>]</span>
<a name="line-116"></a>        <span class='hs-varid'>progressRecords</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ProgressRecord</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>flagsExtra</span><span class='hs-keyglyph'>]</span>
<a name="line-117"></a>        <span class='hs-varid'>changeDirectory</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listToMaybe</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ChangeDirectory</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>flagsExtra</span><span class='hs-keyglyph'>]</span>
<a name="line-118"></a>        <span class='hs-varid'>printDirectory</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>last</span> <span class='hs-varop'>$</span> <span class='hs-conid'>False</span> <span class='hs-conop'>:</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PrintDirectory</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>flagsExtra</span><span class='hs-keyglyph'>]</span>
<a name="line-119"></a>        <span class='hs-varid'>oshakeOpts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl'</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>baseOpts</span> <span class='hs-varid'>flagsShake</span>
<a name="line-120"></a>        <span class='hs-varid'>shakeOpts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>oshakeOpts</span> <span class='hs-layout'>{</span><span class='hs-varid'>shakeLintInside</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>toStandard</span> <span class='hs-varop'>.</span> <span class='hs-varid'>normalise</span> <span class='hs-varop'>.</span> <span class='hs-varid'>addTrailingPathSeparator</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-121"></a>                                                  <span class='hs-varid'>shakeLintInside</span> <span class='hs-varid'>oshakeOpts</span>
<a name="line-122"></a>                               <span class='hs-layout'>,</span><span class='hs-varid'>shakeLintIgnore</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toStandard</span> <span class='hs-varop'>$</span>
<a name="line-123"></a>                                                  <span class='hs-varid'>shakeLintIgnore</span> <span class='hs-varid'>oshakeOpts</span>
<a name="line-124"></a>                               <span class='hs-layout'>}</span>
<a name="line-125"></a>
<a name="line-126"></a>    <span class='hs-comment'>-- error if you pass some clean and some dirty with specific flags</span>
<a name="line-127"></a>    <span class='hs-varid'>errs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>errs</span> <span class='hs-varop'>++</span> <span class='hs-varid'>flagsError</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"cannot mix "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>a</span> <span class='hs-varop'>++</span> <span class='hs-str'>" and "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>a</span><span class='hs-conop'>:</span><span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span>
<a name="line-128"></a>        <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-str'>"`--assume-new'"</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>assumeNew</span><span class='hs-varop'>/=</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"`--assume-old'"</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>assumeOld</span><span class='hs-varop'>/=</span><span class='hs-conid'>[]</span> <span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"explicit targets"</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>files</span><span class='hs-varop'>/=</span><span class='hs-conid'>[]</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-129"></a>
<a name="line-130"></a>    <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>errs</span> <span class='hs-varop'>/=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-131"></a>        <span class='hs-varid'>putStr</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unlines</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-str'>"shake: "</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>null</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lines</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unlines</span> <span class='hs-varid'>errs</span>
<a name="line-132"></a>        <span class='hs-varid'>showHelp</span>
<a name="line-133"></a>        <span class='hs-varid'>exitFailure</span>
<a name="line-134"></a>
<a name="line-135"></a>    <span class='hs-keyword'>if</span> <span class='hs-conid'>Help</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span> <span class='hs-keyword'>then</span>
<a name="line-136"></a>        <span class='hs-varid'>showHelp</span>
<a name="line-137"></a>     <span class='hs-keyword'>else</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>Version</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span> <span class='hs-keyword'>then</span>
<a name="line-138"></a>        <span class='hs-varid'>putStrLn</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Shake build system, version "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>showVersion</span> <span class='hs-varid'>version</span>
<a name="line-139"></a>     <span class='hs-keyword'>else</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>NumericVersion</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span> <span class='hs-keyword'>then</span>
<a name="line-140"></a>        <span class='hs-varid'>putStrLn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>showVersion</span> <span class='hs-varid'>version</span>
<a name="line-141"></a>     <span class='hs-keyword'>else</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>Demo</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span> <span class='hs-keyword'>then</span>
<a name="line-142"></a>        <span class='hs-varid'>demo</span> <span class='hs-varop'>$</span> <span class='hs-varid'>shakeStaunch</span> <span class='hs-varid'>shakeOpts</span>
<a name="line-143"></a>     <span class='hs-keyword'>else</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>not</span> <span class='hs-varop'>$</span> <span class='hs-varid'>null</span> <span class='hs-varid'>progressReplays</span> <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span>
<a name="line-144"></a>        <span class='hs-varid'>dat</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>forM</span> <span class='hs-varid'>progressReplays</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>file</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-145"></a>            <span class='hs-varid'>src</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readFile</span> <span class='hs-varid'>file</span>
<a name="line-146"></a>            <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>file</span><span class='hs-layout'>,</span> <span class='hs-varid'>map</span> <span class='hs-varid'>read</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lines</span> <span class='hs-varid'>src</span><span class='hs-layout'>)</span>
<a name="line-147"></a>        <span class='hs-varid'>forM_</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varop'>$</span> <span class='hs-varid'>shakeReport</span> <span class='hs-varid'>shakeOpts</span> <span class='hs-keyword'>then</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"-"</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>shakeReport</span> <span class='hs-varid'>shakeOpts</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>file</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-148"></a>            <span class='hs-varid'>putStrLn</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Writing report to "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>file</span>
<a name="line-149"></a>            <span class='hs-varid'>writeProgressReport</span> <span class='hs-varid'>file</span> <span class='hs-varid'>dat</span>
<a name="line-150"></a>     <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<a name="line-151"></a>        <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sleep</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>threadDelay</span> <span class='hs-num'>1000000</span>
<a name="line-152"></a>        <span class='hs-varid'>start</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getCurrentTime</span>
<a name="line-153"></a>        <span class='hs-varid'>curdir</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getCurrentDirectory</span>
<a name="line-154"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>redir</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>changeDirectory</span> <span class='hs-keyword'>of</span>
<a name="line-155"></a>                <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>id</span>
<a name="line-156"></a>                <span class='hs-comment'>-- get the "html" directory so it caches with the current directory</span>
<a name="line-157"></a>                <span class='hs-comment'>-- required only for debug code</span>
<a name="line-158"></a>                <span class='hs-conid'>Just</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>bracket_</span> <span class='hs-layout'>(</span><span class='hs-varid'>getDataFileName</span> <span class='hs-str'>"html"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>setCurrentDirectory</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>setCurrentDirectory</span> <span class='hs-varid'>curdir</span><span class='hs-layout'>)</span>
<a name="line-159"></a>        <span class='hs-varid'>shakeOpts</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>progressRecords</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>return</span> <span class='hs-varid'>shakeOpts</span> <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<a name="line-160"></a>            <span class='hs-varid'>t</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>offsetTime</span>
<a name="line-161"></a>            <span class='hs-varid'>return</span> <span class='hs-varid'>shakeOpts</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeProgress</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-162"></a>                <span class='hs-varid'>bracket</span>
<a name="line-163"></a>                    <span class='hs-layout'>(</span><span class='hs-varid'>forkIO</span> <span class='hs-varop'>$</span> <span class='hs-varid'>shakeProgress</span> <span class='hs-varid'>shakeOpts</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-164"></a>                    <span class='hs-varid'>killThread</span>
<a name="line-165"></a>                    <span class='hs-varop'>$</span> <span class='hs-varid'>const</span> <span class='hs-varop'>$</span> <span class='hs-varid'>progressDisplay</span> <span class='hs-num'>1</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varop'>$</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-166"></a>                        <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>p</span>
<a name="line-167"></a>                        <span class='hs-varid'>t</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>t</span>
<a name="line-168"></a>                        <span class='hs-varid'>forM_</span> <span class='hs-varid'>progressRecords</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>file</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-169"></a>                            <span class='hs-varid'>appendFile</span> <span class='hs-varid'>file</span> <span class='hs-varop'>$</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span><span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span> <span class='hs-str'>"\n"</span>
<a name="line-170"></a>                        <span class='hs-varid'>return</span> <span class='hs-varid'>p</span>
<a name="line-171"></a>            <span class='hs-layout'>}</span>
<a name="line-172"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>ran</span><span class='hs-layout'>,</span><span class='hs-varid'>res</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>redir</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-173"></a>            <span class='hs-varid'>when</span> <span class='hs-varid'>printDirectory</span> <span class='hs-varop'>$</span> <span class='hs-varid'>putStrLn</span> <span class='hs-varop'>$</span> <span class='hs-str'>"shake: In directory `"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>curdir</span> <span class='hs-varop'>++</span> <span class='hs-str'>"'"</span>
<a name="line-174"></a>            <span class='hs-varid'>rules</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rules</span> <span class='hs-varid'>user</span> <span class='hs-varid'>files</span>
<a name="line-175"></a>            <span class='hs-keyword'>case</span> <span class='hs-varid'>rules</span> <span class='hs-keyword'>of</span>
<a name="line-176"></a>                <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>False</span><span class='hs-layout'>,</span><span class='hs-conid'>Right</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-177"></a>                <span class='hs-conid'>Just</span> <span class='hs-varid'>rules</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-178"></a>                    <span class='hs-varid'>res</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>try_</span> <span class='hs-varop'>$</span> <span class='hs-varid'>shake</span> <span class='hs-varid'>shakeOpts</span> <span class='hs-varop'>$</span>
<a name="line-179"></a>                        <span class='hs-keyword'>if</span> <span class='hs-conid'>NoBuild</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>withoutActions</span> <span class='hs-varid'>rules</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>rules</span>
<a name="line-180"></a>                    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>True</span><span class='hs-layout'>,</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<a name="line-181"></a>
<a name="line-182"></a>        <span class='hs-keyword'>if</span> <span class='hs-varid'>not</span> <span class='hs-varid'>ran</span> <span class='hs-varop'>||</span> <span class='hs-varid'>shakeVerbosity</span> <span class='hs-varid'>shakeOpts</span> <span class='hs-varop'>&lt;</span> <span class='hs-conid'>Normal</span> <span class='hs-varop'>||</span> <span class='hs-conid'>NoTime</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span> <span class='hs-keyword'>then</span>
<a name="line-183"></a>            <span class='hs-varid'>either</span> <span class='hs-varid'>throwIO</span> <span class='hs-varid'>return</span> <span class='hs-varid'>res</span>
<a name="line-184"></a>         <span class='hs-keyword'>else</span>
<a name="line-185"></a>            <span class='hs-keyword'>let</span> <span class='hs-varid'>esc</span> <span class='hs-varid'>code</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>Color</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>escape</span> <span class='hs-varid'>code</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>id</span>
<a name="line-186"></a>            <span class='hs-keyword'>in</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>res</span> <span class='hs-keyword'>of</span>
<a name="line-187"></a>                <span class='hs-conid'>Left</span> <span class='hs-varid'>err</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-188"></a>                    <span class='hs-keyword'>if</span> <span class='hs-conid'>Exception</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flagsExtra</span> <span class='hs-keyword'>then</span>
<a name="line-189"></a>                        <span class='hs-varid'>throwIO</span> <span class='hs-varid'>err</span>
<a name="line-190"></a>                    <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<a name="line-191"></a>                        <span class='hs-varid'>putStrLn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>esc</span> <span class='hs-str'>"31"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>show</span> <span class='hs-varid'>err</span>
<a name="line-192"></a>                        <span class='hs-varid'>exitFailure</span>
<a name="line-193"></a>                <span class='hs-conid'>Right</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-194"></a>                    <span class='hs-varid'>stop</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getCurrentTime</span>
<a name="line-195"></a>                    <span class='hs-keyword'>let</span> <span class='hs-varid'>tot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>diffUTCTime</span> <span class='hs-varid'>stop</span> <span class='hs-varid'>start</span>
<a name="line-196"></a>                        <span class='hs-layout'>(</span><span class='hs-varid'>mins</span><span class='hs-layout'>,</span><span class='hs-varid'>secs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>divMod</span> <span class='hs-layout'>(</span><span class='hs-varid'>ceiling</span> <span class='hs-varid'>tot</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-num'>60</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-197"></a>                        <span class='hs-varid'>time</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varid'>mins</span> <span class='hs-varop'>++</span> <span class='hs-str'>":"</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'0'</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>secs</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>10</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>secs</span>
<a name="line-198"></a>                    <span class='hs-varid'>putStrLn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>esc</span> <span class='hs-str'>"32"</span> <span class='hs-varop'>$</span> <span class='hs-str'>"Build completed in "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>time</span> <span class='hs-varop'>++</span> <span class='hs-str'>"m"</span>
<a name="line-199"></a>    <span class='hs-keyword'>where</span>
<a name="line-200"></a>        <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>wrap</span> <span class='hs-conid'>Left</span> <span class='hs-varop'>.</span> <span class='hs-varid'>snd</span><span class='hs-layout'>)</span> <span class='hs-varid'>shakeOptsEx</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>wrap</span> <span class='hs-conid'>Right</span><span class='hs-layout'>)</span> <span class='hs-varid'>userOptions</span>
<a name="line-201"></a>        <span class='hs-varid'>showHelp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-202"></a>            <span class='hs-varid'>progName</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getProgName</span>
<a name="line-203"></a>            <span class='hs-varid'>putStr</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unlines</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-str'>"Usage: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>progName</span> <span class='hs-varop'>++</span> <span class='hs-str'>" [options] [target] ..."</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-str'>"Options:"</span> <span class='hs-conop'>:</span> <span class='hs-varid'>showOptDescr</span> <span class='hs-varid'>opts</span>
<a name="line-204"></a>
<a name="line-205"></a>        <span class='hs-varid'>wrap</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OptDescr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OptDescr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-206"></a>        <span class='hs-varid'>wrap</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmapOptDescr</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span>
<a name="line-207"></a>
<a name="line-208"></a>
<a name="line-209"></a><a name="showOptDescr"></a><span class='hs-definition'>showOptDescr</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>OptDescr</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span>
<a name="line-210"></a><span class='hs-definition'>showOptDescr</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concat</span>
<a name="line-211"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>nargs</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>26</span> <span class='hs-keyword'>then</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"  "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>args</span> <span class='hs-varop'>++</span> <span class='hs-varid'>replicate</span> <span class='hs-layout'>(</span><span class='hs-num'>28</span> <span class='hs-comment'>-</span> <span class='hs-varid'>nargs</span><span class='hs-layout'>)</span> <span class='hs-chr'>' '</span> <span class='hs-varop'>++</span> <span class='hs-varid'>desc</span><span class='hs-keyglyph'>]</span>
<a name="line-212"></a>                     <span class='hs-keyword'>else</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"  "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>args</span><span class='hs-layout'>,</span> <span class='hs-varid'>replicate</span> <span class='hs-num'>30</span> <span class='hs-chr'>' '</span> <span class='hs-varop'>++</span> <span class='hs-varid'>desc</span><span class='hs-keyglyph'>]</span>
<a name="line-213"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Option</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>desc</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xs</span>
<a name="line-214"></a>    <span class='hs-layout'>,</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>intercalate</span> <span class='hs-str'>", "</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>short</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>long</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<a name="line-215"></a>    <span class='hs-layout'>,</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>args</span><span class='hs-keyglyph'>]</span>
<a name="line-216"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>short</span> <span class='hs-conid'>NoArg</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"-"</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span>
<a name="line-217"></a>          <span class='hs-varid'>short</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"-"</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-str'>" "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>b</span>
<a name="line-218"></a>          <span class='hs-varid'>short</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptArg</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"-"</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-str'>"[="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>b</span> <span class='hs-varop'>++</span> <span class='hs-str'>"]"</span>
<a name="line-219"></a>          <span class='hs-varid'>long</span> <span class='hs-conid'>NoArg</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"--"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>x</span>
<a name="line-220"></a>          <span class='hs-varid'>long</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"--"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>x</span> <span class='hs-varop'>++</span> <span class='hs-str'>"="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>b</span>
<a name="line-221"></a>          <span class='hs-varid'>long</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptArg</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"--"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>x</span> <span class='hs-varop'>++</span> <span class='hs-str'>"[="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>b</span> <span class='hs-varop'>++</span> <span class='hs-str'>"]"</span>
<a name="line-222"></a>
<a name="line-223"></a>
<a name="line-224"></a><a name="fmapOptDescr"></a><span class='hs-definition'>fmapOptDescr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OptDescr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OptDescr</span> <span class='hs-varid'>b</span>
<a name="line-225"></a><span class='hs-definition'>fmapOptDescr</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Option</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Option</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varid'>d</span>
<a name="line-226"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span>
<a name="line-227"></a>          <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varop'>.</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-228"></a>          <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptArg</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OptArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varop'>.</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-229"></a>
<a name="line-230"></a>
<a name="line-231"></a><a name="shakeOptDescrs"></a><span class='hs-comment'>-- | A list of command line options that can be used to modify 'ShakeOptions'. Each option returns</span>
<a name="line-232"></a><span class='hs-comment'>--   either an error message (invalid argument to the flag) or a function that changes some fields</span>
<a name="line-233"></a><span class='hs-comment'>--   in 'ShakeOptions'. The command line flags are @make@ compatible where possbile, but additional</span>
<a name="line-234"></a><span class='hs-comment'>--   flags have been added for the extra options Shake supports.</span>
<a name="line-235"></a><span class='hs-definition'>shakeOptDescrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>OptDescr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-conid'>ShakeOptions</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShakeOptions</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-236"></a><span class='hs-definition'>shakeOptDescrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>fmapOptDescr</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>snd</span><span class='hs-layout'>)</span> <span class='hs-varid'>o</span> <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-conid'>True</span><span class='hs-layout'>,</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>shakeOptsEx</span><span class='hs-keyglyph'>]</span>
<a name="line-237"></a>
<a name="line-238"></a><a name="Extra"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Extra</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ChangeDirectory</span> <span class='hs-conid'>FilePath</span>
<a name="line-239"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Version</span>
<a name="line-240"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NumericVersion</span>
<a name="line-241"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AssumeNew</span> <span class='hs-conid'>FilePath</span>
<a name="line-242"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AssumeOld</span> <span class='hs-conid'>FilePath</span>
<a name="line-243"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PrintDirectory</span> <span class='hs-conid'>Bool</span>
<a name="line-244"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Color</span>
<a name="line-245"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Help</span>
<a name="line-246"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Sleep</span>
<a name="line-247"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoTime</span>
<a name="line-248"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Exception</span>
<a name="line-249"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoBuild</span>
<a name="line-250"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ProgressRecord</span> <span class='hs-conid'>FilePath</span>
<a name="line-251"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ProgressReplay</span> <span class='hs-conid'>FilePath</span>
<a name="line-252"></a>           <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Demo</span>
<a name="line-253"></a>             <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Eq</span>
<a name="line-254"></a>
<a name="line-255"></a>
<a name="line-256"></a><a name="unescape"></a><span class='hs-definition'>unescape</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-257"></a><span class='hs-definition'>unescape</span> <span class='hs-layout'>(</span><span class='hs-chr'>'\ESC'</span><span class='hs-conop'>:</span><span class='hs-chr'>'['</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unescape</span> <span class='hs-varop'>$</span> <span class='hs-varid'>drop</span> <span class='hs-num'>1</span> <span class='hs-varop'>$</span> <span class='hs-varid'>dropWhile</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>isAlpha</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-258"></a><span class='hs-definition'>unescape</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-conop'>:</span> <span class='hs-varid'>unescape</span> <span class='hs-varid'>xs</span>
<a name="line-259"></a><span class='hs-definition'>unescape</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-260"></a>
<a name="line-261"></a><a name="escape"></a><span class='hs-definition'>escape</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-262"></a><span class='hs-definition'>escape</span> <span class='hs-varid'>code</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\ESC["</span> <span class='hs-varop'>++</span> <span class='hs-varid'>code</span> <span class='hs-varop'>++</span> <span class='hs-str'>"m"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>x</span> <span class='hs-varop'>++</span> <span class='hs-str'>"\ESC[0m"</span>
<a name="line-263"></a>
<a name="line-264"></a>
<a name="line-265"></a><a name="shakeOptsEx"></a><span class='hs-comment'>-- | True if it has a potential effect on ShakeOptions</span>
<a name="line-266"></a><span class='hs-definition'>shakeOptsEx</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Bool</span><span class='hs-layout'>,</span> <span class='hs-conid'>OptDescr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Extra</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>ShakeOptions</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ShakeOptions</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-267"></a><span class='hs-definition'>shakeOptsEx</span> <span class='hs-keyglyph'>=</span>
<a name="line-268"></a>    <span class='hs-keyglyph'>[</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"a"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"abbrev"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>pairArg</span> <span class='hs-str'>"abbrev"</span> <span class='hs-str'>"FULL=SHORT"</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>a</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeAbbreviations</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>shakeAbbreviations</span> <span class='hs-varid'>s</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Use abbreviation in status messages."</span>
<a name="line-269"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"B"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"always-make"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeAssume</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Just</span> <span class='hs-conid'>AssumeDirty</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Unconditionally make all targets."</span>
<a name="line-270"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-build"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>NoBuild</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Don't build anything."</span>
<a name="line-271"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"C"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"directory"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>ChangeDirectory</span> <span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"DIRECTORY"</span><span class='hs-layout'>)</span> <span class='hs-str'>"Change to DIRECTORY before doing anything."</span>
<a name="line-272"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"color"</span><span class='hs-layout'>,</span><span class='hs-str'>"colour"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Color</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeOutput</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>outputColor</span> <span class='hs-layout'>(</span><span class='hs-varid'>shakeOutput</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Colorize the output."</span>
<a name="line-273"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"d"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"debug"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeVerbosity</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Diagnostic</span><span class='hs-layout'>,</span> <span class='hs-varid'>shakeOutput</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>outputDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>shakeOutput</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"FILE"</span><span class='hs-layout'>)</span> <span class='hs-str'>"Print lots of debugging information."</span>
<a name="line-274"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"demo"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Demo</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Run in demo mode."</span>
<a name="line-275"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"digest"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeChange</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>ChangeDigest</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Files change when digest changes."</span>
<a name="line-276"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"digest-and"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeChange</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>ChangeModtimeAndDigest</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Files change when modtime and digest change."</span>
<a name="line-277"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"digest-and-input"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeChange</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>ChangeModtimeAndDigestInput</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Files change on modtime (and digest for inputs)."</span>
<a name="line-278"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"digest-or"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeChange</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>ChangeModtimeOrDigest</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Files change when modtime or digest change."</span>
<a name="line-279"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"digest-not"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeChange</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>ChangeModtime</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Files change when modtime changes."</span>
<a name="line-280"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"exception"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Exception</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Throw exceptions directly."</span>
<a name="line-281"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"flush"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>intArg</span> <span class='hs-num'>1</span> <span class='hs-str'>"flush"</span> <span class='hs-str'>"N"</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeFlush</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Just</span> <span class='hs-varid'>i</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Flush metadata every N seconds."</span>
<a name="line-282"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"never-flush"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeFlush</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Never explicitly flush metadata."</span>
<a name="line-283"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"h"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"help"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Help</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Print this message and exit."</span>
<a name="line-284"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"j"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"jobs"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>optIntArg</span> <span class='hs-num'>0</span> <span class='hs-str'>"jobs"</span> <span class='hs-str'>"N"</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeThreads</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>fromMaybe</span> <span class='hs-num'>0</span> <span class='hs-varid'>i</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Allow N jobs/threads at once [default CPUs]."</span>
<a name="line-285"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"k"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"keep-going"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeStaunch</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>True</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Keep going when some targets can't be made."</span>
<a name="line-286"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"l"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"lint"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeLint</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Just</span> <span class='hs-conid'>LintBasic</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Perform limited validation after the run."</span>
<a name="line-287"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"lint-fsatrace"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeLint</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Just</span> <span class='hs-conid'>LintFSATrace</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Use fsatrace to do validation."</span>
<a name="line-288"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-lint"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeLint</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Turn off --lint."</span>
<a name="line-289"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"live"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeLiveFiles</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>shakeLiveFiles</span> <span class='hs-varid'>s</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>fromMaybe</span> <span class='hs-str'>"live.txt"</span> <span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"FILE"</span><span class='hs-layout'>)</span> <span class='hs-str'>"List the files that are live [to live.txt]."</span>
<a name="line-290"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"m"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"metadata"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>reqArg</span> <span class='hs-str'>"PREFIX"</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeFiles</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>x</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Prefix for storing metadata files."</span>
<a name="line-291"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"numeric-version"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>NumericVersion</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Print just the version number and exit."</span>
<a name="line-292"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"o"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"old-file"</span><span class='hs-layout'>,</span><span class='hs-str'>"assume-old"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>AssumeOld</span> <span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"FILE"</span><span class='hs-layout'>)</span> <span class='hs-str'>"Consider FILE to be very old and don't remake it."</span>
<a name="line-293"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"old-all"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeAssume</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Just</span> <span class='hs-conid'>AssumeClean</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Don't remake any files."</span>
<a name="line-294"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"assume-skip"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeAssume</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Just</span> <span class='hs-conid'>AssumeSkip</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Don't remake any files this run."</span>
<a name="line-295"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"skip-commands"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeRunCommands</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>False</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Try and avoid running external programs."</span>
<a name="line-296"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"r"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"report"</span><span class='hs-layout'>,</span><span class='hs-str'>"profile"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeReport</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>shakeReport</span> <span class='hs-varid'>s</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>fromMaybe</span> <span class='hs-str'>"report.html"</span> <span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"FILE"</span><span class='hs-layout'>)</span> <span class='hs-str'>"Write out profiling information [to report.html]."</span>
<a name="line-297"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-reports"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeReport</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>[]</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Turn off --report."</span>
<a name="line-298"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"rule-version"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>reqArg</span> <span class='hs-str'>"VERSION"</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeVersion</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>x</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Version of the build rules."</span>
<a name="line-299"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-rule-version"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeVersionIgnore</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>True</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Ignore the build rules version."</span>
<a name="line-300"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"s"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"silent"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeVerbosity</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Silent</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Don't print anything."</span>
<a name="line-301"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"sleep"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Sleep</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Sleep for a second before building."</span>
<a name="line-302"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"S"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-keep-going"</span><span class='hs-layout'>,</span><span class='hs-str'>"stop"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeStaunch</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>False</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Turns off -k."</span>
<a name="line-303"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"storage"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeStorageLog</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>True</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Write a storage log."</span>
<a name="line-304"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"p"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"progress"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>progress</span> <span class='hs-varop'>$</span> <span class='hs-varid'>optIntArg</span> <span class='hs-num'>1</span> <span class='hs-str'>"progress"</span> <span class='hs-str'>"N"</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeProgress</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>prog</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fromMaybe</span> <span class='hs-num'>5</span> <span class='hs-varid'>i</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Show progress messages [every N secs, default 5]."</span>
<a name="line-305"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-progress"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeProgress</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>const</span> <span class='hs-varop'>$</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Don't show progress messages."</span>
<a name="line-306"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"q"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"quiet"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeVerbosity</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>move</span> <span class='hs-layout'>(</span><span class='hs-varid'>shakeVerbosity</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>pred</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Don't print much."</span>
<a name="line-307"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-time"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>NoTime</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Don't print build time."</span>
<a name="line-308"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"timings"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeTimings</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>True</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Print phase timings."</span>
<a name="line-309"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"touch"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeAssume</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>Just</span> <span class='hs-conid'>AssumeClean</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Assume targets are clean."</span>
<a name="line-310"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>yes</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"V"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"verbose"</span><span class='hs-layout'>,</span><span class='hs-str'>"trace"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>noArg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>{</span><span class='hs-varid'>shakeVerbosity</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>move</span> <span class='hs-layout'>(</span><span class='hs-varid'>shakeVerbosity</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>succ</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"Print tracing information."</span>
<a name="line-311"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"v"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"version"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Version</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Print the version number and exit."</span>
<a name="line-312"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"w"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"print-directory"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>PrintDirectory</span> <span class='hs-conid'>True</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Print the current directory."</span>
<a name="line-313"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>""</span>  <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-print-directory"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>PrintDirectory</span> <span class='hs-conid'>False</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"Turn off -w, even if it was turned on implicitly."</span>
<a name="line-314"></a>    <span class='hs-layout'>,</span><span class='hs-varid'>no</span>  <span class='hs-varop'>$</span> <span class='hs-conid'>Option</span> <span class='hs-str'>"W"</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"what-if"</span><span class='hs-layout'>,</span><span class='hs-str'>"new-file"</span><span class='hs-layout'>,</span><span class='hs-str'>"assume-new"</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>AssumeNew</span> <span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span><span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"FILE"</span><span class='hs-layout'>)</span> <span class='hs-str'>"Consider FILE to be infinitely new."</span>
<a name="line-315"></a>    <span class='hs-keyglyph'>]</span>
<a name="line-316"></a>    <span class='hs-keyword'>where</span>
<a name="line-317"></a>        <span class='hs-varid'>yes</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,)</span> <span class='hs-conid'>True</span>
<a name="line-318"></a>        <span class='hs-varid'>no</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,)</span> <span class='hs-conid'>False</span>
<a name="line-319"></a>
<a name="line-320"></a>        <span class='hs-varid'>move</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Verbosity</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Verbosity</span>
<a name="line-321"></a>        <span class='hs-varid'>move</span> <span class='hs-varid'>x</span> <span class='hs-varid'>by</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toEnum</span> <span class='hs-varop'>$</span> <span class='hs-varid'>min</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromEnum</span> <span class='hs-varid'>mx</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>max</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromEnum</span> <span class='hs-varid'>mn</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>by</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fromEnum</span> <span class='hs-varid'>x</span>
<a name="line-322"></a>            <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-varid'>mn</span><span class='hs-layout'>,</span><span class='hs-varid'>mx</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>asTypeOf</span> <span class='hs-varid'>minBound</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>asTypeOf</span> <span class='hs-varid'>maxBound</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-323"></a>
<a name="line-324"></a>        <span class='hs-varid'>noArg</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-325"></a>        <span class='hs-varid'>reqArg</span> <span class='hs-varid'>a</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-326"></a>        <span class='hs-varid'>intArg</span> <span class='hs-varid'>mn</span> <span class='hs-varid'>flag</span> <span class='hs-varid'>a</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>ReqArg</span> <span class='hs-varid'>a</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>reads</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-327"></a>            <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span><span class='hs-str'>""</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>mn</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-328"></a>            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varop'>$</span> <span class='hs-str'>"the `--"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>flag</span> <span class='hs-varop'>++</span> <span class='hs-str'>"' option requires a number, "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>mn</span> <span class='hs-varop'>++</span> <span class='hs-str'>" or above"</span>
<a name="line-329"></a>        <span class='hs-varid'>optIntArg</span> <span class='hs-varid'>mn</span> <span class='hs-varid'>flag</span> <span class='hs-varid'>a</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>OptArg</span> <span class='hs-varid'>a</span> <span class='hs-varop'>$</span> <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>reads</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-330"></a>            <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span><span class='hs-str'>""</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>mn</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-331"></a>            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varop'>$</span> <span class='hs-str'>"the `--"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>flag</span> <span class='hs-varop'>++</span> <span class='hs-str'>"' option requires a number, "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>mn</span> <span class='hs-varop'>++</span> <span class='hs-str'>" or above"</span>
<a name="line-332"></a>        <span class='hs-varid'>pairArg</span> <span class='hs-varid'>flag</span> <span class='hs-varid'>a</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>ReqArg</span> <span class='hs-varid'>a</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>break</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span> <span class='hs-chr'>'='</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-333"></a>            <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-chr'>'='</span><span class='hs-conop'>:</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-334"></a>            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varop'>$</span> <span class='hs-str'>"the `--"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>flag</span> <span class='hs-varop'>++</span> <span class='hs-str'>"' option requires an = in the argument"</span>
<a name="line-335"></a>
<a name="line-336"></a>        <span class='hs-varid'>progress</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptArg</span> <span class='hs-varid'>func</span> <span class='hs-varid'>msg</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>OptArg</span> <span class='hs-varid'>msg</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>break</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span> <span class='hs-chr'>'='</span><span class='hs-layout'>)</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-337"></a>            <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-str'>"record"</span><span class='hs-layout'>,</span><span class='hs-varid'>file</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>ProgressRecord</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>file</span> <span class='hs-keyword'>then</span> <span class='hs-str'>"progress.txt"</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>tail</span> <span class='hs-varid'>file</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-338"></a>            <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-str'>"replay"</span><span class='hs-layout'>,</span><span class='hs-varid'>file</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>ProgressReplay</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>file</span> <span class='hs-keyword'>then</span> <span class='hs-str'>"progress.txt"</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>tail</span> <span class='hs-varid'>file</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-339"></a>            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>func</span> <span class='hs-varid'>x</span>
<a name="line-340"></a>
<a name="line-341"></a>        <span class='hs-varid'>outputDebug</span> <span class='hs-varid'>output</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>output</span>
<a name="line-342"></a>        <span class='hs-varid'>outputDebug</span> <span class='hs-varid'>output</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>file</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>v</span> <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-343"></a>            <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>v</span> <span class='hs-varop'>/=</span> <span class='hs-conid'>Diagnostic</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>output</span> <span class='hs-varid'>v</span> <span class='hs-varid'>msg</span>
<a name="line-344"></a>            <span class='hs-varid'>appendFile</span> <span class='hs-varid'>file</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unescape</span> <span class='hs-varid'>msg</span> <span class='hs-varop'>++</span> <span class='hs-str'>"\n"</span>
<a name="line-345"></a>
<a name="line-346"></a>        <span class='hs-varid'>outputColor</span> <span class='hs-varid'>output</span> <span class='hs-varid'>v</span> <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>output</span> <span class='hs-varid'>v</span> <span class='hs-varop'>$</span> <span class='hs-varid'>escape</span> <span class='hs-str'>"34"</span> <span class='hs-varid'>msg</span>
<a name="line-347"></a>
<a name="line-348"></a>        <span class='hs-varid'>prog</span> <span class='hs-varid'>i</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-349"></a>            <span class='hs-varid'>program</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>progressProgram</span>
<a name="line-350"></a>            <span class='hs-varid'>progressDisplay</span> <span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>progressTitlebar</span> <span class='hs-varid'>s</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>program</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>p</span>
</pre></body>
</html>
