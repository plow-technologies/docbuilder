<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Text/XML/HXT/Arrow/WriteDocument.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>-- ------------------------------------------------------------</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>{- |
<a name="line-4"></a>   Module     : Text.XML.HXT.Arrow.WriteDocument
<a name="line-5"></a>   Copyright  : Copyright (C) 2005-9 Uwe Schmidt
<a name="line-6"></a>   License    : MIT
<a name="line-7"></a>
<a name="line-8"></a>   Maintainer : Uwe Schmidt (uwe@fh-wedel.de)
<a name="line-9"></a>   Stability  : experimental
<a name="line-10"></a>   Portability: portable
<a name="line-11"></a>
<a name="line-12"></a>   Compound arrow for writing XML documents
<a name="line-13"></a>
<a name="line-14"></a>-}</span>
<a name="line-15"></a>
<a name="line-16"></a><span class='hs-comment'>-- ------------------------------------------------------------</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>XML</span><span class='hs-varop'>.</span><span class='hs-conid'>HXT</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>WriteDocument</span>
<a name="line-19"></a>    <span class='hs-layout'>(</span> <span class='hs-varid'>writeDocument</span>
<a name="line-20"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>writeDocument'</span>
<a name="line-21"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>writeDocumentToString</span>
<a name="line-22"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>prepareContents</span>
<a name="line-23"></a>    <span class='hs-layout'>)</span>
<a name="line-24"></a><span class='hs-keyword'>where</span>
<a name="line-25"></a>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span>                            <span class='hs-comment'>-- arrow classes</span>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>ArrowList</span>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>ArrowIf</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>ArrowTree</span>
<a name="line-30"></a>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>XML</span><span class='hs-varop'>.</span><span class='hs-conid'>HXT</span><span class='hs-varop'>.</span><span class='hs-conid'>DOM</span><span class='hs-varop'>.</span><span class='hs-conid'>Interface</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>XML</span><span class='hs-varop'>.</span><span class='hs-conid'>HXT</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>XmlArrow</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>XML</span><span class='hs-varop'>.</span><span class='hs-conid'>HXT</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>XmlState</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>XML</span><span class='hs-varop'>.</span><span class='hs-conid'>HXT</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>XmlState</span><span class='hs-varop'>.</span><span class='hs-conid'>TypeDefs</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>XML</span><span class='hs-varop'>.</span><span class='hs-conid'>HXT</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>XmlState</span><span class='hs-varop'>.</span><span class='hs-conid'>RunIOStateArrow</span>
<a name="line-37"></a>                                                <span class='hs-layout'>(</span> <span class='hs-varid'>initialSysState</span>
<a name="line-38"></a>                                                <span class='hs-layout'>)</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>XML</span><span class='hs-varop'>.</span><span class='hs-conid'>HXT</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>Edit</span>                  <span class='hs-layout'>(</span> <span class='hs-varid'>haskellRepOfXmlDoc</span>
<a name="line-40"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>indentDoc</span>
<a name="line-41"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>addDefaultDTDecl</span>
<a name="line-42"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>preventEmptyElements</span>
<a name="line-43"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>removeDocWhiteSpace</span>
<a name="line-44"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>treeRepOfXmlDoc</span>
<a name="line-45"></a>                                                <span class='hs-layout'>)</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>XML</span><span class='hs-varop'>.</span><span class='hs-conid'>HXT</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span><span class='hs-varop'>.</span><span class='hs-conid'>DocumentOutput</span>        <span class='hs-layout'>(</span> <span class='hs-varid'>putXmlDocument</span>
<a name="line-47"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>encodeDocument</span>
<a name="line-48"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>encodeDocument'</span>
<a name="line-49"></a>                                                <span class='hs-layout'>)</span>
<a name="line-50"></a>
<a name="line-51"></a><span class='hs-comment'>-- ------------------------------------------------------------</span>
<a name="line-52"></a><span class='hs-comment'>--</span>
<a name="line-53"></a>
<a name="line-54"></a><span class='hs-comment'>{- |
<a name="line-55"></a>the main filter for writing documents
<a name="line-56"></a>
<a name="line-57"></a>this filter can be configured by an option list like 'Text.XML.HXT.Arrow.ReadDocument.readDocument'
<a name="line-58"></a>
<a name="line-59"></a>usage: @ writeDocument optionList destination @
<a name="line-60"></a>
<a name="line-61"></a>if @ destination @ is the empty string or \"-\", stdout is used as output device
<a name="line-62"></a>
<a name="line-63"></a>for available options see 'Text.XML.HXT.Arrow.XmlState.SystemConfig'
<a name="line-64"></a>
<a name="line-65"></a>
<a name="line-66"></a>- @withOutputXML@ :
<a name="line-67"></a> (default) issue XML: quote special XML chars \&gt;,\&lt;,\",\',&amp; where neccessary
<a name="line-68"></a>                   add XML processing instruction
<a name="line-69"></a>                   and encode document with respect to output encoding,
<a name="line-70"></a>
<a name="line-71"></a>- @withOutputHTML@ :
<a name="line-72"></a> issue HTML: translate all special XML chars and all HTML chars with a corresponding entity reference
<a name="line-73"></a> into entity references. Do not generate empty elements, e.g. @&lt;script .../&gt;@ for HTML elements, that are allowed
<a name="line-74"></a> to contain a none empty body. Result is for the example is @&lt;script ...&gt;&lt;/script&gt;@.
<a name="line-75"></a> The short form introduces trouble in various browsers.
<a name="line-76"></a>
<a name="line-77"></a>- @withOutputXHTML@ :
<a name="line-78"></a> same as @withOutputHTML@, but all none ASCII chars are substituted by char references.
<a name="line-79"></a>
<a name="line-80"></a>- @withOutputPLAIN@ :
<a name="line-81"></a> Do not substitute any chars. This is useful when generating something else than XML/HTML, e.g. Haskell source code.
<a name="line-82"></a>
<a name="line-83"></a>- @withXmlPi yes/no@ :
<a name="line-84"></a> Add a @&lt;?xml version=... encoding=... ?&gt;@ processing instruction to the beginning of the document.
<a name="line-85"></a> Default is yes.
<a name="line-86"></a>
<a name="line-87"></a>- @withAddDefaultDTD@ :
<a name="line-88"></a>  if the document to be written was build by reading another document containing a Document Type Declaration,
<a name="line-89"></a>  this DTD is inserted into the output document (default: no insert)
<a name="line-90"></a>
<a name="line-91"></a>- @withShowTree yes/no@ :
<a name="line-92"></a>  show DOM tree representation of document (for debugging)
<a name="line-93"></a>
<a name="line-94"></a>- @withShowHaskell yes/no@ :
<a name="line-95"></a>  show Haskell representaion of document (for debugging)
<a name="line-96"></a>
<a name="line-97"></a> a minimal main program for copying a document
<a name="line-98"></a> has the following structure:
<a name="line-99"></a>
<a name="line-100"></a>&gt; module Main
<a name="line-101"></a>&gt; where
<a name="line-102"></a>&gt;
<a name="line-103"></a>&gt; import Text.XML.HXT.Core
<a name="line-104"></a>&gt;
<a name="line-105"></a>&gt; main        :: IO ()
<a name="line-106"></a>&gt; main
<a name="line-107"></a>&gt;     = do
<a name="line-108"></a>&gt;       runX ( readDocument  [] "hello.xml"
<a name="line-109"></a>&gt;              &gt;&gt;&gt;
<a name="line-110"></a>&gt;              writeDocument [] "bye.xml"
<a name="line-111"></a>&gt;            )
<a name="line-112"></a>&gt;       return ()
<a name="line-113"></a>
<a name="line-114"></a>an example for copying a document from the web to standard output with global trace level 1, input trace level 2,
<a name="line-115"></a>output encoding isoLatin1,
<a name="line-116"></a>and evaluation of
<a name="line-117"></a>error code is:
<a name="line-118"></a>
<a name="line-119"></a>&gt; module Main
<a name="line-120"></a>&gt; where
<a name="line-121"></a>&gt;
<a name="line-122"></a>&gt; import Text.XML.HXT.Core
<a name="line-123"></a>&gt; import Text.XML.HXT.Curl
<a name="line-124"></a>&gt; -- or
<a name="line-125"></a>&gt; -- import Text.XML.HXT.HTTP
<a name="line-126"></a>&gt; import System.Exit
<a name="line-127"></a>&gt;
<a name="line-128"></a>&gt; main        :: IO ()
<a name="line-129"></a>&gt; main
<a name="line-130"></a>&gt;     = do
<a name="line-131"></a>&gt;       [rc] &lt;- runX
<a name="line-132"></a>&gt;               ( configSysVars [ withTrace 1          -- set the defaults for all read-,
<a name="line-133"></a>&gt;                               , withCurl []          -- write- and other operations
<a name="line-134"></a>&gt;                                 -- or withHTTP []
<a name="line-135"></a>&gt;                               ]
<a name="line-136"></a>&gt;                 &gt;&gt;&gt;
<a name="line-137"></a>&gt;                 readDocument  [ withTrace     2      -- use these additional
<a name="line-138"></a>&gt;                               , withParseHTML yes    -- options only for this read
<a name="line-139"></a>&gt;                               ]
<a name="line-140"></a>&gt;                               "<a href="http://www.haskell.org/">http://www.haskell.org/</a>"
<a name="line-141"></a>&gt;                 &gt;&gt;&gt;
<a name="line-142"></a>&gt;                 writeDocument [ withOutputEncoding isoLatin1
<a name="line-143"></a>&gt;                               ]
<a name="line-144"></a>&gt;                               ""                     -- output to stdout
<a name="line-145"></a>&gt;                 &gt;&gt;&gt;
<a name="line-146"></a>&gt;                 getErrStatus
<a name="line-147"></a>&gt;               )
<a name="line-148"></a>&gt;       exitWith ( if rc &gt;= c_err
<a name="line-149"></a>&gt;                  then ExitFailure 1
<a name="line-150"></a>&gt;                  else ExitSuccess
<a name="line-151"></a>&gt;                )
<a name="line-152"></a>-}</span>
<a name="line-153"></a>
<a name="line-154"></a><a name="writeDocument"></a><span class='hs-definition'>writeDocument</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SysConfigList</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IOStateArrow</span> <span class='hs-varid'>s</span> <span class='hs-conid'>XmlTree</span> <span class='hs-conid'>XmlTree</span>
<a name="line-155"></a><span class='hs-definition'>writeDocument</span> <span class='hs-varid'>config</span> <span class='hs-varid'>dst</span>
<a name="line-156"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>localSysEnv</span>
<a name="line-157"></a>      <span class='hs-varop'>$</span>
<a name="line-158"></a>      <span class='hs-varid'>configSysVars</span> <span class='hs-varid'>config</span>
<a name="line-159"></a>      <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-160"></a>      <span class='hs-varid'>perform</span> <span class='hs-layout'>(</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-varid'>writeDocument'</span><span class='hs-layout'>)</span> <span class='hs-varid'>dst</span> <span class='hs-varop'>$&lt;</span> <span class='hs-varid'>getSysVar</span> <span class='hs-varid'>theTextMode</span> <span class='hs-layout'>)</span>
<a name="line-161"></a>
<a name="line-162"></a><a name="writeDocument'"></a><span class='hs-definition'>writeDocument'</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IOStateArrow</span> <span class='hs-varid'>s</span> <span class='hs-conid'>XmlTree</span> <span class='hs-conid'>XmlTree</span>
<a name="line-163"></a><span class='hs-definition'>writeDocument'</span> <span class='hs-varid'>textMode</span> <span class='hs-varid'>dst</span>
<a name="line-164"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span> <span class='hs-varid'>traceMsg</span> <span class='hs-num'>1</span> <span class='hs-layout'>(</span><span class='hs-str'>"writeDocument: destination is "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>dst</span><span class='hs-layout'>)</span>
<a name="line-165"></a>        <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-166"></a>        <span class='hs-layout'>(</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-varid'>prepareContents</span><span class='hs-layout'>)</span> <span class='hs-varid'>encodeDocument</span> <span class='hs-varop'>$&lt;</span> <span class='hs-varid'>getSysVar</span> <span class='hs-varid'>idS</span> <span class='hs-layout'>)</span>
<a name="line-167"></a>        <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-168"></a>        <span class='hs-varid'>traceDoc</span> <span class='hs-str'>"document after encoding"</span>
<a name="line-169"></a>        <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-170"></a>        <span class='hs-varid'>putXmlDocument</span> <span class='hs-varid'>textMode</span> <span class='hs-varid'>dst</span>
<a name="line-171"></a>        <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-172"></a>        <span class='hs-varid'>traceMsg</span> <span class='hs-num'>1</span> <span class='hs-str'>"writeDocument: finished"</span>
<a name="line-173"></a>      <span class='hs-layout'>)</span>
<a name="line-174"></a>      <span class='hs-varop'>`when`</span>
<a name="line-175"></a>      <span class='hs-varid'>documentStatusOk</span>
<a name="line-176"></a>
<a name="line-177"></a><span class='hs-comment'>-- ------------------------------------------------------------</span>
<a name="line-178"></a>
<a name="line-179"></a><span class='hs-comment'>-- |</span>
<a name="line-180"></a><span class='hs-comment'>-- Convert a document into a string. Formating is done the same way</span>
<a name="line-181"></a><span class='hs-comment'>-- and with the same options as in 'writeDocument'. Default output encoding is</span>
<a name="line-182"></a><span class='hs-comment'>-- no encoding, that means the result is a normal unicode encode haskell string.</span>
<a name="line-183"></a><span class='hs-comment'>-- The default may be overwritten with the 'Text.XML.HXT.Arrow.XmlState.SystemConfig.withOutputEncoding' option.</span>
<a name="line-184"></a><span class='hs-comment'>-- The XML PI can be suppressed by the 'Text.XML.HXT.XmlKeywords.a_no_xml_pi' option.</span>
<a name="line-185"></a><span class='hs-comment'>--</span>
<a name="line-186"></a><span class='hs-comment'>-- This arrow fails, when the encoding scheme is not supported.</span>
<a name="line-187"></a><span class='hs-comment'>-- The arrow is pure, it does not run in the IO monad.</span>
<a name="line-188"></a><span class='hs-comment'>-- The XML PI is suppressed, if not explicitly turned on with an</span>
<a name="line-189"></a><span class='hs-comment'>-- option @ (a_no_xml_pi, v_0) @</span>
<a name="line-190"></a>
<a name="line-191"></a><a name="writeDocumentToString"></a><span class='hs-definition'>writeDocumentToString</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ArrowXml</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SysConfigList</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-conid'>XmlTree</span> <span class='hs-conid'>String</span>
<a name="line-192"></a><span class='hs-definition'>writeDocumentToString</span> <span class='hs-varid'>config</span>
<a name="line-193"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prepareContents</span> <span class='hs-layout'>(</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-varid'>withOutputEncoding</span> <span class='hs-varid'>unicodeString</span> <span class='hs-conop'>:</span>
<a name="line-194"></a>                                        <span class='hs-varid'>withXmlPi</span>          <span class='hs-varid'>no</span>            <span class='hs-conop'>:</span>
<a name="line-195"></a>                                        <span class='hs-varid'>config</span>
<a name="line-196"></a>                                       <span class='hs-layout'>)</span>
<a name="line-197"></a>                        <span class='hs-varop'>$</span> <span class='hs-varid'>initialSysState</span>
<a name="line-198"></a>                      <span class='hs-layout'>)</span> <span class='hs-varid'>encodeDocument'</span>
<a name="line-199"></a>      <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-200"></a>      <span class='hs-varid'>xshow</span> <span class='hs-varid'>getChildren</span>
<a name="line-201"></a>
<a name="line-202"></a><span class='hs-comment'>-- ------------------------------------------------------------</span>
<a name="line-203"></a>
<a name="line-204"></a><span class='hs-comment'>-- |</span>
<a name="line-205"></a><span class='hs-comment'>-- indent and format output</span>
<a name="line-206"></a>
<a name="line-207"></a><a name="prepareContents"></a><span class='hs-definition'>prepareContents</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ArrowXml</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>XIOSysState</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-conid'>XmlTree</span> <span class='hs-conid'>XmlTree</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-conid'>XmlTree</span> <span class='hs-conid'>XmlTree</span>
<a name="line-208"></a><span class='hs-definition'>prepareContents</span> <span class='hs-varid'>config</span> <span class='hs-varid'>encodeDoc</span>
<a name="line-209"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indent</span>
<a name="line-210"></a>      <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-211"></a>      <span class='hs-varid'>addDtd</span>
<a name="line-212"></a>      <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-213"></a>      <span class='hs-varid'>format</span>
<a name="line-214"></a>    <span class='hs-keyword'>where</span>
<a name="line-215"></a>    <span class='hs-varid'>indent'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theIndent</span>      <span class='hs-varid'>config</span>
<a name="line-216"></a>    <span class='hs-varid'>removeWS'</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theRemoveWS</span>    <span class='hs-varid'>config</span>
<a name="line-217"></a>    <span class='hs-varid'>showTree'</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theShowTree</span>    <span class='hs-varid'>config</span>
<a name="line-218"></a>    <span class='hs-varid'>showHaskell'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theShowHaskell</span> <span class='hs-varid'>config</span>
<a name="line-219"></a>    <span class='hs-varid'>outHtml'</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theOutputFmt</span>   <span class='hs-varid'>config</span> <span class='hs-varop'>==</span>  <span class='hs-conid'>HTMLoutput</span>
<a name="line-220"></a>    <span class='hs-varid'>outXhtml'</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theOutputFmt</span>   <span class='hs-varid'>config</span> <span class='hs-varop'>==</span> <span class='hs-conid'>XHTMLoutput</span>
<a name="line-221"></a>    <span class='hs-varid'>outXml'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theOutputFmt</span>   <span class='hs-varid'>config</span> <span class='hs-varop'>==</span>   <span class='hs-conid'>XMLoutput</span>
<a name="line-222"></a>    <span class='hs-varid'>noPi'</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-varop'>$</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theXmlPi</span>       <span class='hs-varid'>config</span>
<a name="line-223"></a>    <span class='hs-varid'>noEEsFor'</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theNoEmptyElemFor</span>  <span class='hs-varid'>config</span>
<a name="line-224"></a>    <span class='hs-varid'>addDDTD'</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theAddDefaultDTD</span>   <span class='hs-varid'>config</span>
<a name="line-225"></a>    <span class='hs-varid'>outEnc'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getS</span> <span class='hs-varid'>theOutputEncoding</span>  <span class='hs-varid'>config</span>
<a name="line-226"></a>
<a name="line-227"></a>    <span class='hs-varid'>addDtd</span>
<a name="line-228"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>addDDTD'</span>                      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addDefaultDTDecl</span>
<a name="line-229"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>this</span>
<a name="line-230"></a>    <span class='hs-varid'>indent</span>
<a name="line-231"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>indent'</span>                       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>indentDoc</span>                     <span class='hs-comment'>-- document indentation</span>
<a name="line-232"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>removeWS'</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>removeDocWhiteSpace</span>           <span class='hs-comment'>-- remove all whitespace between tags</span>
<a name="line-233"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>this</span>
<a name="line-234"></a>
<a name="line-235"></a>    <span class='hs-varid'>format</span>
<a name="line-236"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>showTree'</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>treeRepOfXmlDoc</span>
<a name="line-237"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>showHaskell'</span>                  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>haskellRepOfXmlDoc</span>
<a name="line-238"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>outHtml'</span>                      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>preventEmptyElements</span> <span class='hs-varid'>noEEsFor'</span> <span class='hs-conid'>True</span>
<a name="line-239"></a>                                          <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-240"></a>                                          <span class='hs-varid'>encodeDoc</span>                     <span class='hs-comment'>-- convert doc into text with respect to output encoding with ASCII as default</span>
<a name="line-241"></a>                                            <span class='hs-conid'>False</span> <span class='hs-varid'>noPi'</span> <span class='hs-layout'>(</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>outEnc'</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>usAscii</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>outEnc'</span> <span class='hs-layout'>)</span>
<a name="line-242"></a>
<a name="line-243"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>outXhtml'</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>preventEmptyElements</span> <span class='hs-varid'>noEEsFor'</span> <span class='hs-conid'>True</span>
<a name="line-244"></a>                                          <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-245"></a>                                          <span class='hs-varid'>encodeDoc</span>                     <span class='hs-comment'>-- convert doc into text with respect to output encoding</span>
<a name="line-246"></a>                                            <span class='hs-conid'>True</span> <span class='hs-varid'>noPi'</span> <span class='hs-varid'>outEnc'</span>
<a name="line-247"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>outXml'</span>                       <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>noEEsFor'</span>
<a name="line-248"></a>                                            <span class='hs-keyword'>then</span> <span class='hs-varid'>this</span>
<a name="line-249"></a>                                            <span class='hs-keyword'>else</span> <span class='hs-varid'>preventEmptyElements</span> <span class='hs-varid'>noEEsFor'</span> <span class='hs-conid'>False</span>
<a name="line-250"></a>                                          <span class='hs-layout'>)</span>
<a name="line-251"></a>                                          <span class='hs-varop'>&gt;&gt;&gt;</span>
<a name="line-252"></a>                                          <span class='hs-varid'>encodeDoc</span>                     <span class='hs-comment'>-- convert doc into text with respect to output encoding</span>
<a name="line-253"></a>                                            <span class='hs-conid'>True</span> <span class='hs-varid'>noPi'</span> <span class='hs-varid'>outEnc'</span>
<a name="line-254"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>this</span>
<a name="line-255"></a>
<a name="line-256"></a><span class='hs-comment'>-- ------------------------------------------------------------</span>
</pre></body>
</html>
